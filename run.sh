#!/bin/bash

# ะกะบัะธะฟั ะดะปั ะทะฐะฟััะบะฐ MEXC Bot

echo "๐ ะะฐะฟััะบ MEXC Bot..."

# ะัะพะฒะตัะบะฐ ะฝะฐะปะธัะธั Python
if ! command -v python3 &> /dev/null; then
    echo "โ Python3 ะฝะต ะฝะฐะนะดะตะฝ. ะฃััะฐะฝะพะฒะธัะต Python 3.8+"
    exit 1
fi

# ะัะพะฒะตัะบะฐ ะฒะธัััะฐะปัะฝะพะณะพ ะพะบััะถะตะฝะธั
if [ ! -d ".venv" ]; then
    echo "โ ะะธัััะฐะปัะฝะพะต ะพะบััะถะตะฝะธะต ะฝะต ะฝะฐะนะดะตะฝะพ"
    echo "ะกะพะทะดะฐะนัะต ะตะณะพ ะบะพะผะฐะฝะดะพะน: python3 -m venv .venv"
    exit 1
fi

# ะะบัะธะฒะฐัะธั ะฒะธัััะฐะปัะฝะพะณะพ ะพะบััะถะตะฝะธั
echo "๐ง ะะบัะธะฒะฐัะธั ะฒะธัััะฐะปัะฝะพะณะพ ะพะบััะถะตะฝะธั..."
source .venv/bin/activate

# ะัะพะฒะตัะบะฐ ะฝะฐะปะธัะธั ะทะฐะฒะธัะธะผะพััะตะน
if [ ! -f "requirements.txt" ]; then
    echo "โ ะคะฐะนะป requirements.txt ะฝะต ะฝะฐะนะดะตะฝ"
    exit 1
fi

# ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน
echo "๐ฆ ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน..."
pip install -r requirements.txt

# ะัะพะฒะตัะบะฐ ะบะพะฝัะธะณััะฐัะธะธ
if [ ! -f "config.py" ]; then
    echo "โ ะคะฐะนะป config.py ะฝะต ะฝะฐะนะดะตะฝ"
    exit 1
fi

# ะกะพะทะดะฐะฝะธะต ะดะธัะตะบัะพัะธะธ ะดะปั ะปะพะณะพะฒ
mkdir -p logs

# ะะฐะฟััะบ ะฑะพัะฐ ะฒ ัะพะฝะพะฒะพะผ ัะตะถะธะผะต
echo "๐ ะะฐะฟััะบ ะฑะพัะฐ ะฒ ัะพะฝะพะฒะพะผ ัะตะถะธะผะต..."
nohup python main.py > logs/bot.log 2>&1 &

# ะกะพััะฐะฝะตะฝะธะต PID
echo $! > bot.pid

echo "โ ะะพั ะทะฐะฟััะตะฝ ั PID: $(cat bot.pid)"
echo "๐ ะะพะณะธ ัะพััะฐะฝััััั ะฒ: logs/bot.log"
echo "๐ ะะปั ะพััะฐะฝะพะฒะบะธ ะฒัะฟะพะปะฝะธัะต: ./stop.sh"
echo "๐ ะะปั ะฟัะพัะผะพััะฐ ะปะพะณะพะฒ: tail -f logs/bot.log"
echo "โฐ ะะฑะฝะพะฒะปะตะฝะธะต ัะตะฝ: ะบะฐะถะดัะต 10 ัะตะบัะฝะด"
echo "๐ฏ ะะพะฝะธัะพัะธะฝะณ: 10 ะบัะธะฟัะพะฟะฐั"
echo "๐ฑ Telegram: ะฐะฒัะพะผะฐัะธัะตัะบะธะต ัะฒะตะดะพะผะปะตะฝะธั"
